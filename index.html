<script>
    // ESTA ES TU URL ACTUALIZADA
    const SCRIPT_MAESTRO = "https://script.google.com/macros/s/AKfycbyMXYuuGGXaLPcYUDwJOje4KEdYR5HMQdt7FwzpjR0dam05lkH6_-IUdJ062tsd27pRIg/exec";

    // Función principal para enviar datos y archivos
    async function enviarConComprobante(payload, fileInput, exitoId, folioId, wppLinkId) {
        if (!fileInput || fileInput.files.length === 0) {
            return alert("Por favor, adjunta tu comprobante de pago para procesar la solicitud.");
        }
        
        const reader = new FileReader();
        const archivo = fileInput.files[0];
        reader.readAsDataURL(archivo);
        
        reader.onload = async () => {
            payload.archivo = reader.result;
            payload.archivoNombre = archivo.name;

            // Envío de datos al Script Maestro
            await fetch(SCRIPT_MAESTRO, { 
                method: 'POST', 
                mode: 'no-cors', 
                body: JSON.stringify(payload) 
            });

            // Mostrar mensaje de éxito en la pantalla
            document.getElementById(exitoId).classList.remove("hidden");
            document.getElementById(folioId).innerText = payload.folio;
            
            // Configurar mensaje de WhatsApp
            const textoWpp = `Hola Diana, envié mi registro de ${payload.tipo || payload.accion} (Folio: ${payload.folio}). El comprobante ya está en el sistema.`;
            document.getElementById(wppLinkId).href = `https://wa.me/528131983700?text=${encodeURIComponent(textoWpp)}`;
        };
    }

    // Botón: Análisis Rápido
    function enviarRapido() {
        const payload = {
            tipo: "AnalisisRapido",
            nombre: document.getElementById("nombreR").value,
            tel: document.getElementById("telR").value,
            curp: document.getElementById("curpR").value,
            nss: document.getElementById("nssR").value,
            folio: "R-" + Math.floor(1000 + Math.random() * 9000)
        };
        enviarConComprobante(payload, document.getElementById("archivoR"), "exitoR", "folioR_ver", "wpp_doc_link");
    }

    // Botón: Solicitud de Documentos ($15)
    function solicitarDocumento() {
        const payload = {
            accion: "GuardarDocumento",
            curp: document.getElementById("doc_curp").value.trim().toUpperCase(),
            tipoDoc: document.getElementById("doc_tipo").value,
            folio: "DOC-" + Math.floor(1000 + Math.random() * 9000)
        };
        enviarConComprobante(payload, document.getElementById("archivo_pago"), "exitoDoc", "folioDoc_ver", "wpp_doc_link");
    }

    // Botón: Modalidad 10
    function validarYEnviarM10() {
        const payload = {
            tipo: "M10",
            nombre: document.getElementById("m10_nombre").value,
            idOficial: document.getElementById("m10_id").value,
            tel: document.getElementById("m10_tel").value,
            salario: document.getElementById("m10_salario").value,
            domicilio: document.getElementById("m10_dom").value,
            folio: "M10-" + Math.floor(1000 + Math.random() * 9000)
        };
        enviarConComprobante(payload, document.getElementById("m10_comprobante"), "exitoM10", "folioM10_ver", "m10_link_wpp");
    }
</script>
